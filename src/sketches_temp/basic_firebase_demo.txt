#include <WiFi.h>
#include <FirebaseESP32.h>

// Wi-Fi credentials
#define WIFI_SSID "GAMSUNG"
#define WIFI_PASSWORD "aleahgwapa"
// Firebase project credentials
#define FIREBASE_HOST "https://smart-dustbin-43323-default-rtdb.asia-southeast1.firebasedatabase.app/"
#define FIREBASE_AUTH "fSuXR0OytcFzZEiciU5VDycwIAQxBzUbNCuJhcbW"

const char *SSID = "loadout";
const char *PASSWORD = "qwerty123456";

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

void setup()
{
  Serial.begin(115200);
  delay(500);
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to WiFi...");

  unsigned long start = millis();
  while (WiFi.status() != WL_CONNECTED && millis() - start < 20000)
  {
    delay(500);
    Serial.print('.');
  }
  if (WiFi.status() == WL_CONNECTED)
  {
    Serial.println("\n Connected!");
    Serial.print("IP address: ");
    Serial.println(WiFi.localIP());
    Serial.print("Gateway: ");
    config.host = FIREBASE_HOST;
    config.signer.tokens.legacy_token = FIREBASE_AUTH;
    Serial.println(WiFi.gatewayIP());
    Serial.print("Signal (RSSI): ");
    Serial.println(WiFi.RSSI());
  }
  else
  {
    Serial.println("\n Failed to connect (timeout). Check SSID/password and band.");
  }

  Serial.print("Connected with IP: ");
  Serial.println(WiFi.localIP());
  Serial.println();

  config.host = FIREBASE_HOST;
  config.signer.tokens.legacy_token = FIREBASE_AUTH;

  Firebase.reconnectNetwork(true);
  fbdo.setBSSLBufferSize(4096, 1024);
  fbdo.setResponseSize(2048);

  Firebase.begin(&config, &auth);
  Firebase.setReadTimeout(fbdo, 1000 * 60);
  Firebase.setwriteSizeLimit(fbdo, "tiny");
}

void loop()
{
  if (Firebase.getInt(fbdo, "/trash_bins/battery"))
  {
    Serial.print("Read value: ");
    Serial.println(fbdo.intData());
  }
  else
  {
    Serial.print("Read failed: ");
    Serial.println(fbdo.errorReason());
  }
  delay(5000);
  if (Firebase.getString(fbdo, "/trash_bins/location"))
  {
    Serial.print("Read value: ");
    Serial.println(fbdo.stringData());
  }
  else
  {
    Serial.print("Read failed: ");
    Serial.println(fbdo.errorReason());
  }
  delay(5000);
}